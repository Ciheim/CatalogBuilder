Usage
============

Catalogs provide a level of indexing that can greatly speed up data discovery. Therefore, usability is a priority. All catalogs generated by Catalog Builder are accompanied by a Intake-ESM compatable JSON file. 

What is Intake-ESM?
-------------------


Created by NSF, `Intake-ESM <https://intake-esm.readthedocs.io/en/stable/index.html>`_ is a data catalog utility that enables searchability across climate catalogs.

How to ingest using Intake-ESM
------------------------------

**Import needed packages**


.. code-block:: python

 import xarray as xr
 import intake
 import intake_esm
 import matplotlib
 from matplotlib import pyplot as plt
 %matplotlib inline

**Set collection file variable (col_url) to JSON path**

We must provide Intake-ESM with a path to an ESM compatible collection file (JSON). This JSON establishes a link to the generated catalog. 

.. code-block:: python
 
 col_url = "<path-to-JSON>"

 #Ex: col_url = "~/CatalogBuilder/cats/gfdl_test1.json"

 col = intake.open_esm_datastore(col_url)

**Set search parameters**

Search parameters can be set to find specific files. Here, we search for a file using keys such as the experiment name and modeling realm. 

.. code-block:: python

 expname_filter = ['ESM4_1pctCO2_D1']
 modeling_realm = 'atmos'
 model_filter = 'ESM4'
 variable_id_filter = "evap"
 ens_filter = "r1i1p1f1"
 frequency = "monthly"
 chunk_freq = "5yr" #assuming we have 10 yr also, this will give unique ones

**Search the catalog**

Now, we execute our query:

.. code-block:: python

 cat = col.search(experiment_id=expname_filter,frequency=frequency,modeling_realm=modeling_realm,
                 source_id=model_filter,variable_id=variable_id_filter)

 cat.df["path"][0]

Intake will return the path to the file(s) that match these search parameters.


